<!DOCTYPE html>
<html>
  <body>
    <p>Click the button to get your coordinates.</p>

    <button onclick="getLocation()">Try It</button>

    <p id="demo"></p>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>

    <script>
      var x = document.getElementById("demo");
      var mqttClient;

      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition);
        } else {
          x.innerHTML = "Geolocation is not supported by this browser.";
        }
      }

      function showPosition(position) {
        x.innerHTML =
          "Latitude: " +
          position.coords.latitude +
          "<br>Longitude: " +
          position.coords.longitude;

        // Connect to MQTT broker
        mqttClient = new Paho.MQTT.Client(
          "mqtt://broker.emqx.io",
          8083,
          "gps-mqtt-500"
        );
        mqttClient.connect({ onSuccess: onConnect });
      }

      function onConnect() {
        // Publish coordinates to an MQTT topic
        var message = new Paho.MQTT.Message(
          JSON.stringify({
            latitude: position.coords.latitude,
            longitude: position.coords.longitude,
          })
        );
        message.destinationName = "/RESTful";
        mqttClient.send(message);
      }
    </script>
  </body>
</html>
